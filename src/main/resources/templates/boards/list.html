<!-- 수정: src/main/resources/templates/boards/list.html -->
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/default}">
<head>
    <title>게시판</title>
</head>
<body>
<main layout:fragment="content">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2>게시판</h2>
        <!-- 글쓰기 버튼 (인증 조건 추가) -->
        <div>
            <a th:href="@{/boards/new}" class="btn btn-primary"
               sec:authorize="isAuthenticated()">글쓰기</a>
            <a th:href="@{/login}" class="btn btn-outline-primary"
               sec:authorize="isAnonymous()">로그인하고 글쓰기</a>
        </div>
    </div>

    <!-- 검색 -->
    <form th:action="@{/boards}" method="get" class="row g-3 mb-4">
        <div class="col-auto">
            <input type="text" name="keyword" class="form-control"
                   placeholder="검색어 입력" th:value="${keyword}">
        </div>
        <div class="col-auto">
            <button type="submit" class="btn btn-outline-secondary">검색</button>
        </div>
        <div class="col-auto" th:if="${keyword}">
            <a th:href="@{/boards}" class="btn btn-outline-secondary">초기화</a>
        </div>
    </form>

    <!-- 게시글 목록 -->
    <table class="table table-hover">
        <thead class="table-light">
            <tr>
                <th style="width: 80px">번호</th>
                <th>제목</th>
                <th style="width: 120px">작성자</th>
                <th style="width: 100px">조회수</th>
                <th style="width: 120px">작성일</th>
            </tr>
        </thead>
        <tbody>
            <tr th:each="board : ${boards}">
                <td th:text="${board.id}">1</td>
                <td>
                    <a th:href="@{/boards/{id}(id=${board.id})}"
                       th:text="${board.title}">제목</a>
                    <!-- 본인 글 표시 - 추가 -->
                    <span class="badge bg-primary ms-1"
                          sec:authorize="isAuthenticated()"
                          th:if="${currentUsername == board.writerUsername}">내 글</span>
                </td>
                <td th:text="${board.writerName}">작성자</td>
                <td th:text="${board.viewCount}">0</td>
                <td th:text="${#temporals.format(board.createdAt, 'yyyy-MM-dd')}">2025-01-22</td>
            </tr>
            <tr th:if="${#lists.isEmpty(boards)}">
                <td colspan="5" class="text-center text-muted py-5">
                    게시글이 없습니다.
                </td>
            </tr>
        </tbody>
    </table>

    <!-- 페이징 -->
    <nav th:if="${page.totalPages > 1}" aria-label="Page navigation">
        <ul class="pagination justify-content-center">
            <!-- 이전 -->
            <li class="page-item" th:classappend="${page.first} ? 'disabled'">
                <a class="page-link"
                   th:href="@{/boards(page=${page.number - 1}, keyword=${keyword})}">
                    이전
                </a>
            </li>

            <!-- 페이지 번호 -->
            <th:block th:with="start=${page.number > 2 ? page.number - 2 : 0},
                              end=${page.number + 2 < page.totalPages ? page.number + 2 : page.totalPages - 1}">
                <li class="page-item"
                    th:each="i : ${#numbers.sequence(start, end)}"
                    th:classappend="${i == page.number} ? 'active'">
                    <a class="page-link"
                       th:href="@{/boards(page=${i}, keyword=${keyword})}"
                       th:text="${i + 1}">1</a>
                </li>
            </th:block>

            <!-- 다음 -->
            <li class="page-item" th:classappend="${page.last} ? 'disabled'">
                <a class="page-link"
                   th:href="@{/boards(page=${page.number + 1}, keyword=${keyword})}">
                    다음
                </a>
            </li>
        </ul>
    </nav>

    <!-- 검색 결과 정보 -->
    <div class="text-center text-muted" th:if="${page.totalElements > 0}">
        총 <span th:text="${page.totalElements}">0</span>건
    </div>
</main>
</body>
</html>
